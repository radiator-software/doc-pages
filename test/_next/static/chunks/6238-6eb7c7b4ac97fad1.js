"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6238],{68032:(e,a,t)=>{t.d(a,{K:()=>l});var n=t(12115);let l=e=>(0,n.useCallback)(a=>{a&&a.setCustomValidity(e)},[e])},86238:(e,a,t)=>{t.d(a,{W:()=>en});var n=t(95155),l=t(24068),s=t(23532),r=t(54621),i=t(53816),o=t(12879),d=t(41983),u=t(42063),c=t(68212),m=t(26578),h=t(12115),p=t(78470),j=t(61023),f=t(22822),x=t(70690),w=t(2778),g=t(52363),v=t(65036),b=t(56422),y=t(75912),A=t(86946),C=t(4484),N=t(14915),E=t(84544),P=t(9693),S=t(48563),k=t(89489),_=t(80549);let F=async(e,a)=>await e.post("password-hash",{json:a}).json();var I=t(4474),D=t(68032);let M=e=>{if("none"===e.algorithm){let{algorithm:a,...t}=e;return(0,n.jsx)(E.y,{...t})}return(0,n.jsx)(T,{...e})},T=e=>{let{autoFocus:a,...t}=e,[l,s]=(0,m.e)(),[r,i]=(0,h.useState)(""),[o,d]=(0,h.useState)(""),{data:u,mutate:c,status:j,reset:f}=(()=>{let e=(0,k.JN)();return(0,_.n)({mutationFn:a=>F(e,a)})})(),x=r===o&&!!(null==u?void 0:u.hash),w=[];""===r.trim()?w.push("No password provided"):r!==o&&w.push("Passwords do not match"),(null==u?void 0:u.hash)||w.push("Password hash not created yet");let g=w.join(", "),v=(0,D.K)(g);return(0,h.useEffect)(()=>{r&&r===o&&"none"!==t.algorithm?c({password:r,algorithm:t.algorithm}):f()},[o,c,r,t.algorithm,f]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.y,{...t,value:r,autoFocus:a,onChange:e=>{i(e.target.value)},showPassword:l,onToggleShowPassword:s,id:"_plaintext-"+t.name,name:"_plaintext-"+t.name,label:t.name}),(0,n.jsx)(E.y,{...t,autoFocus:!1,inputRef:v,value:o,onChange:e=>{d(e.target.value)},showPassword:l,onToggleShowPassword:s,id:"_confirm-"+t.name,name:"_confirm-"+t.name,label:"confirm "+t.name,extraAdornment:"pending"===j?(0,n.jsx)(I.A,{size:15}):"error"===j?(0,n.jsx)(p.A,{title:"Password hashing failed!",children:(0,n.jsx)(S.A,{color:"error"})}):x?(0,n.jsx)(p.A,{title:"Password hashed successfully",children:(0,n.jsx)(P.A,{color:"success"})}):(0,n.jsx)(p.A,{title:g,children:(0,n.jsx)(S.A,{color:"warning"})})}),(0,n.jsx)("input",{type:"hidden",required:!0,name:t.name,value:x?null==u?void 0:u.hash:""})]})};var U=t(99776);let L=async(e,a,t)=>await e.post("ui/query/".concat(a,"/UI_").concat(t.toUpperCase(),"_TABLE_INFO")).json(),R=["rid","id"],q=e=>{for(let a of R)if("number"==typeof(null==e?void 0:e[a]))return e[a];throw Error("Invalid Radiator backend configuration: The backend must a row id column. One of ".concat(R.join(", ")," must be present."))},z=async(e,a,t,n)=>await e.post("ui/query-paginated/".concat(a,"/UI_").concat(t.toUpperCase(),"_FIND"),{json:n}).json(),K=async(e,a,t,n,l)=>{let s=await e.post("ui/query/".concat(a,"/UI_").concat(t.toUpperCase(),"_EDIT"),{json:l,searchParams:{id:n}}).json(),r=null==s?void 0:s[0];if(!r)throw Error("Failed to edit table row. Nothing returned.");return r},O=async(e,a,t,n)=>await e.post("ui/query/".concat(a,"/UI_").concat(t.toUpperCase(),"_STORE"),{json:n}).json(),H=async(e,a,t,n)=>await e.post("ui/query/".concat(a,"/UI_").concat(t.toUpperCase(),"_DELETE"),{searchParams:{id:n}}).json();var V=t(17060),W=t(55058),J=t(74938),Q=t(27414);let Z=e=>1===e||!0===e,B=e=>["id"].includes(e.name)?(0,n.jsx)(V.A,{}):["name","username"].includes(e.name)?"clients"===e.kind?(0,n.jsx)(W.A,{}):(0,n.jsx)(Q.A,{}):["ip"].includes(e.name)?(0,n.jsx)(J.A,{}):null;var G=t(71991),$=t(50001),X=t(61764);let Y=e=>{let[a,t]=(0,h.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.A,{title:"Add hashed password",children:(0,n.jsx)(d.default,{className:"ml-1 mr-1",onClick:()=>{t(!0)},children:(0,n.jsx)(X.A,{fontSize:"small"})})}),(0,n.jsxs)(w.A,{open:a,onClose:()=>{t(!1)},fullWidth:!0,PaperProps:{component:"form",onSubmit:async a=>{a.preventDefault();let n=new FormData(a.currentTarget).get("password");"string"==typeof n&&(e.onNewHashedPassword(n),t(!1))}},children:[(0,n.jsx)(g.A,{children:"Password"}),(0,n.jsxs)(v.A,{className:"flex flex-col gap-3",children:[(0,n.jsx)($.A,{children:"Create a new password hash"}),(0,n.jsx)(M,{required:!0,autoFocus:!0,name:"password",algorithm:"argon2"})]}),"r",(0,n.jsxs)(y.A,{children:[(0,n.jsx)(x.default,{type:"button",variant:"outlined",onClick:()=>{t(!1)},children:"Cancel"}),(0,n.jsx)(x.default,{variant:"contained",type:"submit",children:"Add"})]})]})]})},ee=e=>{let[a,t]=(0,m.e)(),l=a?e.secret:"••••••••••••••";return(0,n.jsxs)("div",{className:"flex h-full w-full items-center justify-between",children:[(0,n.jsx)("div",{className:"text-ellipsis overflow-hidden",children:l}),(0,n.jsx)(p.A,{title:"Toggle ".concat(e.name," visibility"),children:(0,n.jsx)(d.default,{"aria-label":"Toggle ".concat(e.name," visibility"),onClick:()=>t(),children:a?(0,n.jsx)(c.A,{}):(0,n.jsx)(u.A,{})})})]})};function ea(e){return["secret","password"].includes(e.name)?(0,n.jsx)(ee,{name:e.name,secret:e.row[e.name]}):null===e.value?(0,n.jsx)("span",{className:"italic text-gray-500",children:"NULL"}):(0,n.jsx)("span",{children:e.value})}function et(e){let{id:a,value:t,field:s,hasFocus:r}=e,i=["INTEGER","REAL"].includes(e.type),o=(0,l.h)(),d=(0,h.useRef)(void 0);return(0,h.useLayoutEffect)(()=>{d.current&&r&&d.current.focus()},[r]),(0,n.jsxs)("div",{className:"flex h-full w-full items-center justify-between",children:[(0,n.jsx)(j.A,{inputRef:d,type:i&&null!==t?"number":"text",variant:"filled",hiddenLabel:!0,size:"small",slotProps:{htmlInput:{"aria-label":s}},value:null===t?"NULL":t,onChange:e=>{var t;let n=e.target.value;null==(t=o.current)||t.setEditCellValue({id:a,field:s,value:n})},className:"p-1"+(null===t?" italic":"")}),["secret","password"].includes(e.field)?(0,n.jsx)(Y,{onNewHashedPassword:e=>{var t;null==(t=o.current)||t.setEditCellValue({id:a,field:s,value:e})}}):null,e.nullable&&(0,n.jsx)(p.A,{title:"Toggle NULL value",children:(0,n.jsx)(f.A,{checked:null===t,onChange:e=>{var t;let n=e.target.checked;null==(t=o.current)||t.setEditCellValue({id:a,field:s,value:n?null:i?0:""})}})})]})}let en=e=>{var a,t,l,d;let u=null==(t=e.tableNameIsPlural)||t?e.tableName.replace(/s$/,""):e.tableName,c=(0,s.b)(),[f,E]=(0,h.useState)({pageSize:20,page:0}),[P,S]=(0,h.useState)([{field:e.defaultSortField,sort:"asc"}]),{data:F,isLoading:I}=((e,a,t)=>(0,k.V8)([e,a,"pagination-".concat(t.limit,"-").concat(t.offset,"-").concat(t.order_by,"-").concat(t.order_dir)],n=>z(n,e,a,t),{keepPreviousData:!0}))(e.dbName,e.tableName,{limit:f.pageSize,offset:f.pageSize*f.page,order_by:P[0]&&P[0].field,order_dir:null!=(l=P[0]&&P[0].sort)?l:void 0}),D=null==F?void 0:F.items,T=null==F?void 0:F.total,V=((e,a)=>{let t=(0,U.jE)(),n=(0,k.JN)();return(0,_.n)({mutationFn:t=>{let{id:l,data:s}=t;return K(n,e,a,l,s)},onSuccess:async()=>{await t.invalidateQueries({queryKey:[e,a]})}})})(e.dbName,e.tableName),W=((e,a)=>{let t=(0,U.jE)(),n=(0,k.JN)();return(0,_.n)({mutationFn:t=>{let{data:l}=t;return O(n,e,a,l)},onSuccess:async()=>{await t.invalidateQueries({queryKey:[e,a]})}})})(e.dbName,e.tableName),J=((e,a)=>{let t=(0,U.jE)(),n=(0,k.JN)();return(0,_.n)({mutationFn:t=>{let{id:l}=t;return H(n,e,a,l)},onSuccess:async()=>{await t.invalidateQueries({queryKey:[e,a]})}})})(e.dbName,e.tableName),[Q,$]=(0,h.useState)(void 0),X=()=>{$(void 0)},Y=((e,a)=>(0,k.V8)(["tableInfo",e,a],t=>L(t,e,a)))(e.dbName,e.tableName),ee=I||Y.isLoading,en=[...(null!=(d=Y.data)?d:[]).map(a=>({field:a.name,headerName:a.name,width:200,renderHeader:()=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(B,{kind:e.tableName,name:a.name}),(0,n.jsx)("span",{className:"text-lg font-bold",children:a.name})]}),align:"left",headerAlign:"left",renderCell:e=>(0,n.jsx)(ea,{name:a.name,...e}),renderEditCell:e=>(0,n.jsx)(et,{type:a.type,nullable:!a.notnull,...e}),editable:!0})),{field:"actions",type:"actions",headerName:"Actions",width:150,cellClassName:"actions",align:"center",getActions:e=>{let{id:a}=e;return[(0,n.jsx)(p.A,{title:"Edit ".concat(u),children:(0,n.jsx)(r.Z,{icon:(0,n.jsx)(N.A,{}),label:"Edit",onClick:()=>{c.current.startRowEditMode({id:a})},color:"inherit"})},"edit"),(0,n.jsx)(p.A,{title:"Delete ".concat(u),children:(0,n.jsx)(r.Z,{icon:(0,n.jsx)(C.A,{}),label:"Delete",onClick:()=>{$(a)},color:"inherit"})},"delete")]}}],el=async(e,a)=>{let t=await V.mutateAsync({id:q(a),data:e});return(0,G.M8)({message:"Change saved",variant:"success",autoHideDuration:1e3}),t},[es,er]=(0,m.e)(),ei=()=>!!document.querySelector(".MuiDialog-container");return(0,n.jsxs)("div",{className:"w-full h-full flex flex-col gap-4",children:[(0,n.jsx)(i.C,{className:"min-h-96 w-full",onCellKeyDown:(e,a)=>{if("Tab"===a.key){a.defaultMuiPrevented=!0;return}ei()&&(a.defaultMuiPrevented=!0)},onRowEditStop:(e,a)=>{if("target"in a&&"nativeEvent"in a&&a.nativeEvent instanceof KeyboardEvent&&"Enter"===a.nativeEvent.key&&!(a.target instanceof HTMLInputElement)||ei()){a.defaultMuiPrevented=!0;return}},apiRef:c,loading:ee,rows:null!=D?D:[],columns:en,getRowId:q,rowCount:null!=T?T:0,pageSizeOptions:[20,50,100],pagination:!0,paginationModel:f,paginationMode:"server",onPaginationModelChange:E,sortingMode:"server",sortModel:P,onSortModelChange:e=>{S(e)},editMode:"row",processRowUpdate:el,onProcessRowUpdateError:e=>{console.error("Error updating row",e)},disableRowSelectionOnClick:!0,disableColumnFilter:!0,slots:{toolbar:o.O}}),(0,n.jsxs)(x.default,{variant:"outlined",onClick:()=>er(),startIcon:(0,n.jsx)(A.A,{}),children:["Create new ",u]}),(0,n.jsxs)(w.A,{open:es,onClose:()=>er(),PaperProps:{component:"form",onSubmit:async e=>{e.preventDefault();let a=Object.fromEntries(new FormData(e.currentTarget).entries().flatMap(e=>{let[a,t]=e;return a.startsWith("_")?[]:[[a,t.toString()]]}));await W.mutateAsync({data:a}),er()}},children:[(0,n.jsxs)(g.A,{children:["Create new ",u]}),(0,n.jsx)(v.A,{children:null==(a=Y.data)?void 0:a.filter(e=>!R.includes(e.name)).map((a,t)=>["secret","password"].includes(a.name)?(0,n.jsx)(M,{required:Z(a.notnull),autoFocus:0===t,margin:"dense",id:a.name,name:a.name,"aria-label":a.name,label:a.name,fullWidth:!0,variant:"standard",autoComplete:"new-password",algorithm:e.passwordHashAlgorithm},a.name):(0,n.jsx)(j.A,{required:Z(a.notnull),autoFocus:0===t,margin:"dense",id:a.name,name:a.name,"aria-label":a.name,label:a.name,fullWidth:!0,variant:"standard",slotProps:{input:{startAdornment:(0,n.jsx)(b.A,{position:"start",children:(0,n.jsx)(B,{kind:e.tableName,name:a.name})})}},autoComplete:"new-password"},a.name))}),(0,n.jsxs)(y.A,{children:[(0,n.jsx)(x.default,{variant:"outlined",onClick:()=>er(),children:"Cancel"}),(0,n.jsx)(x.default,{variant:"contained",type:"submit",children:"Create"})]})]}),(0,n.jsxs)(w.A,{open:void 0!==Q,onClose:X,PaperProps:{component:"form",onSubmit:async e=>{e.preventDefault(),await J.mutateAsync({id:Q}),X()}},children:[(0,n.jsx)(g.A,{children:"Confirm deletion"}),(0,n.jsxs)(v.A,{children:["Are you sure you want to delete ",u," with ID"," ",Q,"?"]}),(0,n.jsxs)(y.A,{children:[(0,n.jsx)(x.default,{onClick:X,children:"Cancel"}),(0,n.jsx)(x.default,{type:"submit",children:"Delete"})]})]})]})}}}]);